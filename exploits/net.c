#include<stdio.h>
#include<string.h>
#include<stdlib.h>
#include<sys/socket.h>
#include<netinet/in.h>
#include<arpa/inet.h>
#include<errno.h>
#define PORT 8000

void main(){
int sock,newsock;
struct sockaddr_in host,client;
socklen_t sin_size;
int yes=1,reclen=1;
char buffer[1024];

if((sock=socket(PF_INET,SOCK_STREAM,0))==-1)
{printf("error while assigning host socket");
exit(0);}

if(setsockopt(sock,SOL_SOCKET,SO_REUSEPORT,&yes,sizeof(int))==-1)
{printf("error while setting socket options 1 %s" ,strerror(errno));
exit(0);}

if(setsockopt(sock,SOL_SOCKET,SO_REUSEADDR,&yes,sizeof(int))==-1)
{printf("error while setting socket options 2");
exit(0);}

host.sin_family = AF_INET;
host.sin_port = htons(PORT);
host.sin_addr.s_addr = 0;
memset(&host.sin_zero,'\0',8);

if(bind(sock,(struct sockaddr *)&host,sizeof(struct sockaddr))==-1)
{printf("error while binding");
exit(0);}

if((listen(sock,5))==-1)
{printf("error while listening");
exit(0);}

while(1){
sin_size=sizeof(struct sockaddr_in);

if((newsock=accept(sock,(struct sockaddr *)&client,&sin_size))==-1)
{printf("error while accepting a new connection");
exit(0);}

printf("established connection from %s on port %d\n",inet_ntoa(client.sin_addr),ntohs(client.sin_port));
send(newsock,"hello\n",6,0);
reclen=recv(newsock,&buffer,1024,0);
while(reclen>0){
printf("got a message of %d bytes\n",reclen);
printf("%s" ,buffer);
memset(&buffer,'\0',1024);	
reclen=recv(newsock,&buffer,1024,0);
}
close(newsock);
}
}




