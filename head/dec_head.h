#include"network.h"
#include<string.h>





//ETHERNET HEADER

void dec_eth(const u_char *head){
struct eth_hdr *ether = (struct eth_hdr *)head;

printf("\tLayer 2::Ethernet Header\n\n\n{{\n");

printf("Source MAC address --> ");
printf("%02x" ,ether->eth_src_addr[0]);
for(int i=1;i<ETHER_ADDR_LEN;i++)
printf(":%02x" ,ether->eth_src_addr[i]);

printf("\tDestination MAC address --> ");
printf("%02x" ,ether->eth_dest_addr[0]);
for(int i=1;i<ETHER_ADDR_LEN;i++)
printf(":%02x" ,ether->eth_dest_addr[i]);

printf("\nType --> %hu\n}}\n\n" ,ntohs(ether->eth_type));
}



//ARP HEADER

void dec_arp(const u_char *head){

struct arp_hdr *arp = (struct arp_hdr *)head;

printf("\tLayer 3:::ARP Header\n\n\n{{\n");
printf("Hardware Protocol: %hu\tProtocol Type: %hu\n" ,ntohs(arp->htype),ntohs(arp->ptype));
printf("HLength: %02d\tPLength: %02d\t" ,arp->hlen,arp->plen);
printf("Opcode: %hu\n" ,ntohs(arp->opcode));
printf("Sender Haddr: ");
printf("%02x" ,arp->sha[0]);
for(int i=1;i<6;i++)
printf(":%02x" ,arp->sha[i]);

printf("\tSender IP: ");
printf("%d" ,arp->spa[0]);
for(int i=1;i<4;i++)
printf(".%d" ,arp->spa[i]);

printf("\nTarget Haddr: ");
printf("%02x" ,arp->tha[0]);
for(int i=1;i<6;i++)
printf(":%02x" ,arp->tha[i]);

printf("\tTarget IP: ");
printf("%d" ,arp->tpa[0]);
for(int i=1;i<4;i++)
printf(".%d" ,arp->tpa[i]);
}

//IP HEADER

u_int dec_ip(const u_char *head){

struct ip_hdr *ip = (struct ip_hdr *)head;
struct in_addr *ip_addr=(struct in_addr *)&(ip->ip_src_addr);


printf("\tLayer 3:::IP Header\n\n\n{{\n");

printf("Source: %s" ,inet_ntoa(*ip_addr));
ip_addr=(struct in_addr *)&(ip->ip_dest_addr);
printf("\tDestination: %s\n" ,inet_ntoa(*ip_addr));
printf("Type: %u\tID: %hu\tLength: %hu\n}}\n\n" ,(u_int)ip->ip_type,ntohs(ip->ip_id),ntohs(ip->ip_len));
if(ip->ip_type==6)
return ip->ip_head_len;
else return 0;
}


//TCP HEADER

u_int dec_tcp(const u_char *head){
u_int hdr_size;
struct tcp_hdr *tcp = (struct tcp_hdr *)head;

hdr_size= 4*(tcp->tcp_offset);

printf("\tLayer 4::::TCP Header\n\n\n{{\n");
printf("Source Port: %hu\tDestination Port: %hu\n" ,ntohs(tcp->tcp_src_port),ntohs(tcp->tcp_dest_port));
printf("Seq #: %u\tAck #: %u\n" ,ntohl(tcp->tcp_seq),ntohl(tcp->tcp_ack));
printf("Header Size: %u\tFlags: " ,hdr_size);
if(tcp->tcp_flags & TCP_FIN)
printf("FIN ");
if(tcp->tcp_flags & TCP_SYN)
printf("SYN ");
if(tcp->tcp_flags & TCP_RST)
printf("RST ");
if(tcp->tcp_flags & TCP_PUSH)
printf("PUSH ");
if(tcp->tcp_flags & TCP_ACK)
printf("ACK ");
if(tcp->tcp_flags & TCP_URG)
printf("URG ");
printf("\n}}\n\n");

return hdr_size;
}
